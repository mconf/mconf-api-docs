openapi: 3.0.0
info:
  title: Administrative API
  description: |
    Internal administrative API for managing institutions and users.
  version: 0.5.0
servers:
- url: /

paths:
  /institutions/{guid}:
    get:
      summary: Get institution details
      parameters:
      - name: guid
        in: path
        required: true
        description: Institution GUID. A UUID (Universally Unique Identifier) in the format "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Institution details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Institution"
        "404":
          description: Institution not found
        "500":
          description: Internal server error

    put:
      summary: Update institution
      parameters:
      - name: guid
        in: path
        required: true
        description: Institution GUID. A UUID (Universally Unique Identifier) in the format "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateInstitution"
      responses:
        "200":
          description: Institution updated
        "400":
          description: Invalid request body
        "404":
          description: Institution not found
        "409":
          description: Name already exists
        "500":
          description: Internal server error

    delete:
      summary: Delete institution
      description: Permanently deletes an institution and all associated data
      parameters:
      - name: guid
        in: path
        required: true
        description: Institution GUID. A UUID (Universally Unique Identifier) in the format "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Institution deleted successfully
        "404":
          description: Institution not found
        "500":
          description: Internal server error

  /institutions:
    post:
      summary: Create institution
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateInstitution"
      responses:
        "201":
          description: Institution created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Institution"
        "400":
          description: Invalid request body
        "409":
          description: Institution name already exists
        "500":
          description: Internal server error

  /institutions/{guid}/meeting_settings:
    get:
      summary: Get institution meeting settings
      description: Retrieve meeting configuration settings for an institution
      parameters:
      - name: guid
        in: path
        required: true
        description: Institution GUID. A UUID (Universally Unique Identifier) in the format "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Meeting settings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MeetingSettings"
        "404":
          description: Institution not found
        "500":
          description: Internal server error

  /institutions/{guid}/unsubscription:
    post:
      summary: Unsubscribe institution
      description: Unsubscribes an institution, expiring all its shared secrets and preventing new API access
      parameters:
      - name: guid
        in: path
        required: true
        description: Institution GUID. A UUID (Universally Unique Identifier) in the format "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Institution unsubscribed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnsubscribeResponse"
        "404":
          description: Institution not found
        "500":
          description: Internal server error

  /institutions/{guid}/reactivation:
    post:
      summary: Reactivate institution
      description: Reactivates an unsubscribed institution, re-enabling all previously expired shared secrets
      parameters:
      - name: guid
        in: path
        required: true
        description: Institution GUID. A UUID (Universally Unique Identifier) in the format "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Institution reactivated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReactivateResponse"
        "404":
          description: Institution not found
        "500":
          description: Internal server error

  /users/{external_user_id}/anonymization:
    post:
      summary: Anonymize user data
      description: Anonymizes all personal data associated with a user across meetings and recordings
      parameters:
      - name: external_user_id
        in: path
        required: true
        description: External user identifier from the integrating system
        schema:
          type: string
      - name: secret_guid
        in: query
        required: false
        description: Optional secret GUID for additional validation
        schema:
          type: string
          format: uuid
      - name: hash_key
        in: query
        required: false
        description: Optional secret hash used for anonymization. When provided, ensures data is anonymized using the same hash across different systems for consistency.
        schema:
          type: string
      responses:
        "200":
          description: User data anonymized successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnonymizeUserResponse"
        "404":
          description: User not found
        "500":
          description: Internal server error

  /rooms/{external_meeting_id}/anonymization:
    post:
      summary: Anonymize room data
      description: Anonymizes all data associated with a specific room/meeting
      parameters:
      - name: external_meeting_id
        in: path
        required: true
        description: External meeting identifier (room ID). This is any string provided by the API caller to identify a room. Unlike internal meeting IDs which identify individual meeting sessions, external IDs identify rooms where multiple meetings can occur over time.
        schema:
          type: string
      responses:
        "200":
          description: Room data anonymized successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnonymizeRoomResponse"
        "404":
          description: Room not found
        "500":
          description: Internal server error

components:
  schemas:
    Institution:
      type: object
      properties:
        guid:
          type: string
          format: uuid
        name:
          type: string
        shared_secrets:
          type: array
          items:
            $ref: "#/components/schemas/SharedSecret"

    SharedSecret:
      type: object
      properties:
        guid:
          type: string
          format: uuid
        name:
          type: string
        secret:
          type: string

    CreateInstitution:
      type: object
      required:
      - name
      - secret_name
      properties:
        name:
          type: string
          description: Institution name
        secret_name:
          type: string
          description: Name identifier for the institution's shared secret
        meeting_limit:
          type: integer
          minimum: 0
          description: Maximum number of simultaneous meetings allowed for this institution (0 for unlimited)
        participants_limit:
          type: integer
          minimum: 0
          description: Maximum number of participants allowed per meeting for this institution (0 for unlimited)
        retention_days:
          type: integer
          minimum: 1
          description: Number of days recordings are stored before expiring

    UpdateInstitution:
      type: object
      required:
      - name
      properties:
        name:
          type: string
          description: Institution name
        participants_limit:
          type: integer
          minimum: 0
          description: Maximum number of participants allowed per meeting for this institution (0 for unlimited)
        retention_days:
          type: integer
          minimum: 1
          description: Number of days recordings are stored before expiring
        meeting_limit:
          type: integer
          minimum: 0
          description: Maximum number of simultaneous meetings allowed for this institution (0 for unlimited)

    MeetingSettings:
      type: object
      properties:
        institution_guid:
          type: string
          format: uuid
        settings:
          type: array
          items:
            $ref: "#/components/schemas/MeetingSetting"

    MeetingSetting:
      type: object
      properties:
        type:
          type: string
        key:
          type: string
        value:
          type: string

    UnsubscribeResponse:
      type: object
      properties:
        guid:
          type: string
          format: uuid
        unsubscription_timestamp:
          type: string
          format: date-time
        total_expired_secrets:
          type: integer
        expired_secrets:
          type: array
          items:
            $ref: "#/components/schemas/SharedSecret"

    ReactivateResponse:
      type: object
      properties:
        guid:
          type: string
          format: uuid
        total_enabled_secrets:
          type: integer
        enabled_secrets:
          type: array
          items:
            $ref: "#/components/schemas/SharedSecret"

    AnonymizeUserResponse:
      type: object
      properties:
        external_user_id:
          type: string
          description: The anonymized user identifier
        total_anonymized_records:
          type: integer
          description: Total number of records that were anonymized

    AnonymizeRoomResponse:
      type: object
      properties:
        external_meeting_id:
          type: string
          description: The anonymized meeting identifier
        total_anonymized_records:
          type: integer
          description: Total number of records that were anonymized
